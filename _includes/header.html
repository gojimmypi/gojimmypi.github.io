<!-- /_includes/header.html page.layout = {{ page.layout }} -->
{% if (page.layout != "post") and (page.layout != "page") %}
<div class="logo-container header-search" id="headerSearchContainer">
    <div class="header-search__backdrop" aria-hidden="true"></div>

    <table width="99%" cellpadding="0" cellspacing="0" style="border-top:none; border-bottom:none">
        <tr>
            <td>
                <!-- blank space above gojimmypi logo -->
            </td>
            <td>
                <div class="header-search__search" id="headerSearch" style="position:relative; text-wrap:nowrap">
                    <label class="header-search__label" for="searchBox">Search posts:</label>
                    <input class="header-search__input"
                           id="searchBox"
                           type="search"
                           placeholder="Type to search..."
                           autocomplete="off"
                           aria-controls="searchResults"
                           aria-expanded="false"
                           aria-autocomplete="list">
                    <button type="button"
                            id="searchFocusIcon"
                            class="header-search__icon"
                            aria-label="Focus search"
                            tabindex="-1">
                        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                            <circle cx="11" cy="11" r="7"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2" />
                            <line x1="16.65" y1="16.65"
                                  x2="21" y2="21"
                                  stroke="currentColor"
                                  stroke-width="2"
                                  stroke-linecap="round" />
                        </svg>
                    </button>
                    <div class="header-search__results-wrap">
                        <div class="header-search__status" id="searchStatus" aria-live="polite"></div>
                        <ul class="header-search__results" id="searchResults" role="listbox"></ul>
                    </div>
                </div>
            </td>
        </tr>
        <tr style="border-top:none; border-bottom:none">
            <td style="border-top:none; border-bottom:none; vertical-align:middle">
                <a name="home_gojimmypi_logo"
                   id="home_gojimmypi_logo"
                   href="{{ '/' | relative_url }}"
                   class="noline header-search__logo">
                    <img src="{{ '/images/gojimmypi.svg' | relative_url }}" class="jimmy_logo" alt="gojimmypi logo">
                </a>
            </td>
            <td align="left" width="80%" style="vertical-align: middle; border-top: none; border-bottom: none">
                <table width="99%" cellpadding="0" cellspacing="0" style="border-top:none; border-bottom:none; vertical-align:top">
                    <tr>
                        <td width="99%" style="border-top:none; border-bottom:none">
                        </td>
                    </tr>
                    <tr>
                        <td width="99%" style="border-top:none; border-bottom:none">
                            <div class="header-search__blurb">
                                <hr style="opacity: 0.25" />
                                Welcome and thanks for visiting! <br />
                                <hr style="opacity: 0.25" />
                                This site contains various technical details and notes-to-self that perhaps others will find useful. <br />
                                <hr style="opacity: 0.25" />
                                There are no ads here, no sponsored content.
                            </div>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <script>
        window.SITE_BASEURL = "{{ site.baseurl | replace: '//', '/' }}";
    </script>
    <script src="{{ '/js/search.js' | relative_url }}" defer></script>

    <script defer>
        (function () {
            var container = document.getElementById("headerSearchContainer");
            var box = document.getElementById("searchBox");
            var results = document.getElementById("searchResults");

            if (!container || !box || !results) {
                return;
            }

            function setOpen(isOpen) {
                if (isOpen) {
                    container.classList.add("search-open");
                    box.setAttribute("aria-expanded", "true");
                } else {
                    container.classList.remove("search-open");
                    box.setAttribute("aria-expanded", "false");
                    clearActive();
                }
            }

            function hasResults() {
                return results && results.children && results.children.length > 0;
            }

            function clearActive() {
                var active = results.querySelector("li.is-active");
                if (active) {
                    active.classList.remove("is-active");
                }
            }

            function setActiveIndex(idx) {
                var items = results.querySelectorAll("li");
                if (!items || items.length === 0) {
                    return;
                }

                if (idx < 0) {
                    idx = items.length - 1;
                }
                if (idx >= items.length) {
                    idx = 0;
                }

                clearActive();
                items[idx].classList.add("is-active");

                var link = items[idx].querySelector("a");
                if (link && link.scrollIntoView) {
                    link.scrollIntoView({ block: "nearest" });
                }
            }

            function getActiveIndex() {
                var items = results.querySelectorAll("li");
                var i;
                for (i = 0; i < items.length; i += 1) {
                    if (items[i].classList.contains("is-active")) {
                        return i;
                    }
                }
                return -1;
            }

            function clickOutsideHandler(ev) {
                if (!container.contains(ev.target)) {
                    setOpen(false);
                }
            }

            function backdropHandler(ev) {
                if (ev.target && ev.target.classList && ev.target.classList.contains("header-search__backdrop")) {
                    setOpen(false);
                }
            }

            function escapeHandler(ev) {
                if (ev.key === "Escape") {
                    setOpen(false);
                    box.blur();
                }
            }

            function focusSlashHandler(ev) {
                if (ev.key !== "/") {
                    return;
                }

                var tag = (ev.target && ev.target.tagName) ? ev.target.tagName.toLowerCase() : "";
                var isEditable =
                    tag === "input" ||
                    tag === "textarea" ||
                    (ev.target && ev.target.isContentEditable);

                if (isEditable) {
                    return;
                }

                ev.preventDefault();
                box.focus();
            }

            function updateOpenStateSoon() {
                window.setTimeout(function () {
                    setOpen(hasResults() && (box.value || "").trim().length >= 2);
                }, 0);
            }

            box.addEventListener("input", function () {
                updateOpenStateSoon();
            });

            box.addEventListener("focus", function () {
                updateOpenStateSoon();
            });

            box.addEventListener("keydown", function (ev) {
                if (!container.classList.contains("search-open")) {
                    return;
                }

                if (ev.key === "ArrowDown") {
                    ev.preventDefault();
                    setActiveIndex(getActiveIndex() + 1);
                    return;
                }

                if (ev.key === "ArrowUp") {
                    ev.preventDefault();
                    setActiveIndex(getActiveIndex() - 1);
                    return;
                }

                if (ev.key === "Enter") {
                    var active = results.querySelector("li.is-active a");
                    if (active) {
                        ev.preventDefault();
                        window.location.href = active.getAttribute("href");
                    }
                    return;
                }
            });

            document.addEventListener("click", clickOutsideHandler);
            document.addEventListener("click", backdropHandler);
            document.addEventListener("keydown", escapeHandler);
            document.addEventListener("keydown", focusSlashHandler);

            var observer = new MutationObserver(function () {
                updateOpenStateSoon();
            });
            observer.observe(results, { childList: true });
        }());
    </script>

</div>
{% endif %} 