<div class="logo-container header-search" id="headerSearchContainer">
    <a name="home_gojimmypi_logo"
       id="home_gojimmypi_logo"
       href="{{ site.baseurl | replace: '//', '/' }}/"
       class="logo noline header-search__logo">
        <img src="/images/gojimmypi.svg" class="jimmy_logo" alt="gojimmypi logo">
    </a>
    <div class="header-search__search" id="headerSearch">
        <label class="header-search__label" for="searchBox">Search posts</label>
        <input class="header-search__input"
               id="searchBox"
               type="search"
               placeholder="Type to search..."
               autocomplete="off"
               aria-controls="searchResults"
               aria-expanded="false"
               aria-autocomplete="list">
        <div class="header-search__results-wrap">
            <div class="header-search__status" id="searchStatus" aria-live="polite"></div>
            <ul class="header-search__results" id="searchResults" role="listbox"></ul>
        </div>
    </div>


    <script>
        window.SITE_BASEURL = "{{ site.baseurl }}";
    </script>
    <script src="/js/search.js" defer></script>

    <script defer>
        (function () {
            var container = document.getElementById("headerSearchContainer");
            var box = document.getElementById("searchBox");
            var results = document.getElementById("searchResults");

            if (!container || !box || !results) {
                return;
            }

            function setOpen(isOpen) {
                if (isOpen) {
                    container.classList.add("search-open");
                    box.setAttribute("aria-expanded", "true");
                } else {
                    container.classList.remove("search-open");
                    box.setAttribute("aria-expanded", "false");
                    clearActive();
                }
            }

            function hasResults() {
                return results && results.children && results.children.length > 0;
            }

            function clearActive() {
                var active = results.querySelector("li.is-active");
                if (active) {
                    active.classList.remove("is-active");
                }
            }

            function setActiveIndex(idx) {
                var items = results.querySelectorAll("li");
                if (!items || items.length === 0) {
                    return;
                }

                if (idx < 0) {
                    idx = items.length - 1;
                }
                if (idx >= items.length) {
                    idx = 0;
                }

                clearActive();
                items[idx].classList.add("is-active");

                var link = items[idx].querySelector("a");
                if (link && link.scrollIntoView) {
                    link.scrollIntoView({ block: "nearest" });
                }
            }

            function getActiveIndex() {
                var items = results.querySelectorAll("li");
                var i;
                for (i = 0; i < items.length; i += 1) {
                    if (items[i].classList.contains("is-active")) {
                        return i;
                    }
                }
                return -1;
            }

            function clickOutsideHandler(ev) {
                if (!container.contains(ev.target)) {
                    setOpen(false);
                }
            }

            function escapeHandler(ev) {
                if (ev.key === "Escape") {
                    setOpen(false);
                    box.blur();
                }
            }

            function focusSlashHandler(ev) {
                if (ev.key !== "/") {
                    return;
                }

                var tag = (ev.target && ev.target.tagName) ? ev.target.tagName.toLowerCase() : "";
                var isEditable =
                    tag === "input" ||
                    tag === "textarea" ||
                    (ev.target && ev.target.isContentEditable);

                if (isEditable) {
                    return;
                }

                ev.preventDefault();
                box.focus();
            }

            function updateOpenStateSoon() {
                window.setTimeout(function () {
                    setOpen(hasResults() && (box.value || "").trim().length >= 2);
                }, 0);
            }

            box.addEventListener("input", function () {
                updateOpenStateSoon();
            });

            box.addEventListener("focus", function () {
                updateOpenStateSoon();
            });

            box.addEventListener("keydown", function (ev) {
                if (!container.classList.contains("search-open")) {
                    return;
                }

                if (ev.key === "ArrowDown") {
                    ev.preventDefault();
                    setActiveIndex(getActiveIndex() + 1);
                    return;
                }

                if (ev.key === "ArrowUp") {
                    ev.preventDefault();
                    setActiveIndex(getActiveIndex() - 1);
                    return;
                }

                if (ev.key === "Enter") {
                    var active = results.querySelector("li.is-active a");
                    if (active) {
                        ev.preventDefault();
                        window.location.href = active.getAttribute("href");
                    }
                    return;
                }
            });

            document.addEventListener("click", clickOutsideHandler);
            document.addEventListener("keydown", escapeHandler);
            document.addEventListener("keydown", focusSlashHandler);

            var observer = new MutationObserver(function () {
                updateOpenStateSoon();
            });
            observer.observe(results, { childList: true });
        }());
    </script>
</div>
