<!-- /_includes/footer.html -->
<footer>
    <table width="100%">
        <tr>
            <td align="left">
                <span>&copy; {{ site.copyright }}</span>
            </td>
            <td align="center">
                <span>
                    <a href="{{ site.archive_dir | append: '/' | relative_url }}" title="View the archive of all posts">Archive</a>
                </span>
            </td>
            {%- if site.page_debug -%}
            <td align="center" class="footer-badges">
                <a href="https://github.com/gojimmypi/gridster-jekyll-theme/actions/workflows/check-archive-stubs.yml" title="View GitHub archive sub status">
                    <img alt="GitHub Actions status"
                         src="https://github.com/gojimmypi/gridster-jekyll-theme/actions/workflows/check-archive-stubs.yml/badge.svg?branch=gh-pages" />
                </a>
            </td>
            <td align="center" class="footer-badges">
                <a href="https://github.com/gojimmypi/gridster-jekyll-theme/deployments" title="View GitHub deployment status">
                    <img alt="GitHub Pages deployment status"
                         src="https://img.shields.io/github/deployments/gojimmypi/gridster-jekyll-theme/github-pages?label=github-pages" />
                </a>
            </td>
            <td align="center" class="footer-badges">
                {%- if site.preview_site -%}
                <span>
                    {%- if site.canonical_site_url and site.canonical_site_url != "" -%}
                    <a href="{{ site.canonical_site_url | append: page.url | append: "?refer=preview_test_layout" }}" title="View the main site (from test layout)">
                        Go to main site
                    </a>
                    {%- endif -%}
                </span>
                {%- else -%}
                <span>
                    <a href="{{ site.url }}/gridster-jekyll-theme{{ page.url }}?refer=main_footer_to_preview" title="View the preview site">
                        Go to preview
                    </a>
                </span>
                {%- endif -%}
            </td>
            {%- endif -%}
            <td align="right">
                <span><a class="backtotop" href="#top" title="Scroll back to the top of the page">Back to top</a></span>
            </td>
        </tr>
    </table>
</footer>

{%- comment -%}
 thanks Aleksandr Hovhannisyan for tips on code segment copy
    https://www.aleksandrhovhannisyan.com/blog/how-to-add-a-copy-to-clipboard-button-to-your-jekyll-blog/
{%- endcomment -%}

<script>
    /* This is typically the start of non IIFE code */
    const codeBlocks = document.querySelectorAll('.code-header + .highlighter-rouge');
    const copyCodeButtons = document.querySelectorAll('.copy-code-button');


    if ((codeBlocks.length == 0) && (copyCodeButtons.length > 0)) {
        {%-  if jekyll.environment == "development" -%}
        alert("Warning: code block missing. Is your language spec missing or not lower case? Copy icons disabled.");
        {%- endif -%}
    }
    else {
        copyCodeButtons.forEach((copyCodeButton, index) => {
            const code = codeBlocks[index].innerText;
            // some older pages use HTML with a blank innerText, non-blank textContent
            const codeAlt = codeBlocks[index].textContent;

            copyCodeButton.addEventListener('click', () => {
                if (code == "" || code == null) {
                    // use text from innerText
                    window.navigator.clipboard.writeText(codeAlt);
                }
                else {
                    // use text from textContent
                    window.navigator.clipboard.writeText(code);
                }
                copyCodeButton.classList.add('copied');

                setTimeout(() => {
                    copyCodeButton.classList.remove('copied');
                }, 2000);
            });
        });

    }


    const themeMap = {
        light: 'dark',
        dark: 'light',
    };

    /* lamp theme toggle */
    class ThemeToggle {
        constructor({ toggleSelector, themeOwner, storageKey }) {
            /* this is called once at page load time, not every time the lamp is pressed! */
            this.toggleElement = document.querySelector(toggleSelector);
            if (this.toggleElement) {
                this.toggleElement.addEventListener('click', () => this.toggle());
            }
            this.themeOwner = themeOwner;
            this.storageKey = storageKey;
            this.theme = localStorage.getItem(storageKey) || 'light';
            this.syncAriaLabelWithStorage();
        }

        get currentTheme() {
            return this.theme;
        }

        toggle() {
            const oldTheme = this.currentTheme;
            const newTheme = themeMap[oldTheme];

            this.themeOwner.classList.remove(oldTheme);
            this.themeOwner.classList.add(newTheme);

            /* Keep CSS selectors in sync with the current theme */
            this.themeOwner.setAttribute("data-theme", newTheme);

            const forceDarkMode = (newTheme == 'dark') ? true : false;
            ToggleDarkMode(forceDarkMode);

            localStorage.setItem(this.storageKey, newTheme);
            this.theme = newTheme;
            this.syncAriaLabelWithStorage();
        }

        syncAriaLabelWithStorage() {
            const nextTheme = themeMap[this.currentTheme];
            this.toggleElement.setAttribute("aria-label", "Switch to " + nextTheme + " mode theme");
        }
    }


    /* lamp toggle */
    const themeToggle = new ThemeToggle({
        toggleSelector: '#theme-toggle',
        storageKey: 'theme',
        themeOwner: document.documentElement,
    });


    $(document).ready(function () {
        // move to init ?
        var _TheActiveTheme = localStorage.getItem('theme');
        /* alert(_TheActiveTheme); */
        if (_TheActiveTheme == null || _TheActiveTheme == "dark") {
            ToggleDarkMode(true)
        }
    });

</script>

<!-- helper to avoid page-load flash -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.documentElement.classList.remove("theme-preload");
        document.documentElement.style.setProperty("visibility", "visible");
    });
</script>
