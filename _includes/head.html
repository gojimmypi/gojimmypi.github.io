{%- if site.page_debug -%}<!-- file: /_includes/head.html -->{%- endif -%}

{%- if site.page_debug -%}<!-- helper to avoid page-load flash -->{%- endif -%}
<style>
    html {
        background-color: #111111;
        visibility: hidden;
    }

    html[data-theme="light"] {
        background-color: #ffffff;
    }

    /* Critical: prevent material sidebar flash before CSS tokens load */
    .material-sidebar {
        background-color: #f0f1f3;
        color: #111111;
    }

    html[data-theme="dark"] .material-sidebar {
        background-color: #2b2b2b;
        color: #e7eaf0;
    }

    html.theme-preload *, html.theme-preload *::before, html.theme-preload *::after {
        transition: none !important;
    }
</style>

{% if (jekyll.environment == "development") %}
{%- if site.page_debug -%}<!-- jekyll.environment: development -->{%- endif -%}
{%- if site.page_debug -%}<!-- this page is from [{{ page.path }}] -->{%- endif -%}
{% else %}
{%- if site.page_debug -%}<!-- jekyll.environment: production -->{%- endif -%}
{% endif %}

{% if site.ahrefs_analytics %}
<script src="https://analytics.ahrefs.com/analytics.js" data-key="RwCY/0yQXz6mj2UhcKhjTQ" async></script>
{% else %}
{%- if site.page_debug -%}<!-- analytics.ahrefs.com is not enabled -->{%- endif -%}
{% endif %}

{% if site.google_analytics %}
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }

    /* Default consent state (must run before GA loads) */
    gtag("consent", "default", {
        "analytics_storage": "denied",
        "ad_storage": "denied",
        "ad_user_data": "denied",
        "ad_personalization": "denied",
        "wait_for_update": 500
    });
</script>

{%- if site.page_debug -%}<!-- Google tag (gtag.js) -->{%- endif -%}
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LPK5SGT19T"></script>
<script>
    gtag("js", new Date());
    gtag("config", "G-LPK5SGT19T");
</script>
{% else %}
{%- if site.page_debug -%}<!-- google analytics is not enabled -->{%- endif -%}
{% endif %}

{%- if site.page_debug -%}<!-- Fonts: Inter -->{%- endif -%}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="manifest" href="{{ '/manifest.json' | relative_url }}">

<script>
    (function () {
        var key = "theme";
        var savedTheme = null;
        var theme = "dark";

        try {
            savedTheme = localStorage.getItem(key);
        } catch (e) {
            savedTheme = null;
        }

        if (savedTheme === "dark" || savedTheme === "light") {
            theme = savedTheme;
        } else if (window.matchMedia) {
            theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
            try {
                localStorage.setItem(key, theme);
            } catch (e2) {
            }
        }

        var root = document.documentElement;

        root.classList.add("theme-preload");

        root.style.backgroundColor = (theme === "dark") ? "#111111" : "#ffffff";

        root.classList.remove("dark");
        root.classList.remove("light");
        root.classList.add(theme);

        /* Ensure the attribute exists before first paint (sidebar uses it) */
        root.setAttribute("data-theme", theme);

        root.style.setProperty("color-scheme", theme);
    })();
</script>

{%- if site.page_debug -%}<!-- /helper to avoid page-load flash -->{%- endif -%}
<meta content="width=device-width, initial-scale=1" name="viewport" />
{%- if site.page_debug -%}<!-- meta name="color-scheme" content="dark light" -->{%- endif -%}
{%- if site.page_debug -%}<!-- JS -->{%- endif -%}
{%- if site.page_debug -%}<!-- see https://developer.chrome.com/docs/lighthouse/pwa/themed-omnibox/?utm_source=lighthouse&utm_medium=devtools -->{%- endif -%}
<meta name="theme-color" content="#333333" />

<script src="{{ '/js/jquery-3.7.1.min.js' | relative_url }}"></script>

{% if jekyll.environment != "development" %}
<script>
</script>
{% endif %}

{% if page.math %}
<script type="text/x-mathjax-config">
    {% include _mathjax-cdn-setup.min.js %}
</script>
{% endif %}

{% if site.usefallback == null or site.usefallback == true %}
<script>
    {% include _fallback.min.js %}
</script>

<script>
fallback.load({

    main: "{{ site.baseurl | replace: '//', '/' }}/css/main.css?v={% if site.github.build_revision %}{{ site.github.build_revision }}{% else %}{{ site.time | date: '%s' }}{% endif %}",

    jQuery: [
        {% if jekyll.environment != "development" %}
        "https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js",
        {% endif %}
        "{{ site.baseurl | replace: '//', '/' }}/js/jquery-3.7.1.min.js"
    ],

    Materialize: [
        {% if jekyll.environment != "development" %}
        "https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js",
        {% endif %}
        "{{ site.baseurl | replace: '//', '/' }}/js/materialize.min.js"
    ],

    cssTransitionSupport: [
        {% if site.infinite_scroll == true %}
            {% if site.sidebar_toc == true %}
                "{{ site.baseurl | replace: '//', '/' }}/js/global.infinite.toc.min.js"
            {% else %}
                "{{ site.baseurl | replace: '//', '/' }}/js/global.infinite.min.js"
            {% endif %}
        {% else %}
            {% if site.sidebar_toc == true %}
                "{{ site.baseurl | replace: '//', '/' }}/js/global.toc.min.js"
            {% else %}
                "{{ site.baseurl | replace: '//', '/' }}/js/global.min.js"
            {% endif %}
        {% endif %}
    ]
    {% if page.math %},
    MathJax: [
        {% if jekyll.environment != "development" %}
        "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full",
        {% endif %}
        "{{ site.baseurl | replace: '//', '/' }}/MathJax/MathJax.js?config=TeX-AMS_CHTML-full"
    ]
    {% endif %}

}, {
    shim: {
        "Materialize": ["jQuery"],
        "cssTransitionSupport": ["Materialize"]
    }
});
</script>

{% else %}
<link rel="stylesheet" href="{{ '/css/main.css' | relative_url }}?v={% if site.github.build_revision %}{{ site.github.build_revision }}{% else %}{{ site.time | date: '%s' }}{% endif %}">

<script src="{{ '/scripts/jquery.toc.js' | relative_url }}"></script>
<script src="{{ '/scripts/infinite/1-jquery.jscroll.js' | relative_url }}"></script>
<script src="{{ '/scripts/global/2-imagelightbox.js' | relative_url }}?forceversion=2"></script>
<script src="{{ '/scripts/global/scripts.js' | relative_url }}"></script>
<script src="{{ '/js/materialize.min.js' | relative_url }}"></script>
<script src="{{ '/scripts/infinite/init.js' | relative_url }}?forceversion=2"></script>
{% endif %}

<script>
    window.SITE_BASEURL = "{{ site.baseurl | replace: '//', '/' }}";
</script>
<script src="{{ '/js/search.js' | relative_url }}" defer></script>

{% if page.sidebar_toc %}
<script>
    fallback.ready(function () {
        $('#post-content').toc({
            renderIn: '#renderTOC',
            showCollapsed: true,
            minItemsToShowToc: 0
        });
    });
</script>

{%- if site.page_debug -%}<!-- CSS -->{%- endif -%}
<style type="text/css">
    {% capture include_to_scssify %}
        {% include _heading.scss %}
    {% endcapture %}
    {{ include_to_scssify | scssify }}
</style>
{% endif %}

{% if page.amsthm %}
<style type="text/css">
    {% capture include_to_scssify %}
        {% include _amsthm.scss %}
    {% endcapture %}
    {{ include_to_scssify | scssify }}
</style>
{% endif %}

{%- if site.page_debug -%}<!-- Google Analytics. Put the ID in _config.yml -->{%- endif -%}
{% if jekyll.environment != "development" %}
<script>
</script>
{% endif %}

{%- if site.page_debug -%}<!-- Load the user's last selected theme for the lamp -->{%- endif -%}
<script>
    {% include _dark_mode.js %}
</script>

<link rel="stylesheet" id="color-change">

{%- if site.page_debug -%}<!-- Site Infos -->{%- endif -%}

{%- assign raw_title = "" -%}
{%- if page.title and page.title != blank -%}
    {%- assign raw_title = page.title -%}
{%- else -%}
    {%- assign raw_title = site.title | default: "Untitled" -%}
{%- endif -%}
{%- assign clean_title = raw_title | strip_html | normalize_whitespace -%}

{%- assign raw_desc = "" -%}
{%- if page.description and page.description != blank -%}
    {%- assign raw_desc = page.description -%}
{%- elsif page.excerpt and page.excerpt != blank -%}
    {%- assign raw_desc = page.excerpt -%}
{%- else -%}
    {%- assign raw_desc = site.description | default: "" -%}
{%- endif -%}
{%- assign clean_desc = raw_desc | strip_html | normalize_whitespace | truncate: 155, "" -%}

{%- comment -%}
Let jekyll-seo-tag emit canonical/OG/Twitter/JSON-LD,
but NOT title or description. We emit those ourselves.
{%- endcomment -%}
{%- seo title=false description=false -%}

<title>{{ clean_title }}</title>

{%- if clean_desc and clean_desc != blank -%}
<meta name="description" content="{{ clean_desc }}">
<meta property="og:description" content="{{ clean_desc }}">
<meta name="twitter:description" content="{{ clean_desc }}">
{%- endif -%}

{% include favicon.html %}
