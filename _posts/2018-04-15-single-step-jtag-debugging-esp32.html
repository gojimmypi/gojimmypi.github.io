---
layout: post
title: Single Step JTAG debugging an ESP32 Arduino Sketch with VisualGDB
date: '2018-04-15T18:00:00.001-07:00'
author: gojimmypi
tags: 
modified_time: '2018-07-09T09:03:17.829-07:00'
thumbnail: https://1.bp.blogspot.com/-sFq2SJuaA14/Ws4x0Bgz4fI/AAAAAAAABQY/eRFUfKZTDVAA-ZMvQYU9iiyepEv3a67XgCLcBGAs/s72-c/ArduinoConversion.PNG
blogger_id: tag:blogger.com,1999:blog-4109066286647243251.post-2224027445487449351
blogger_orig_url: https://gojimmypi.blogspot.com/2018/04/single-step-jtag-debugging-esp32.html
---

In my <a href="{{ site.baseurl }}{% post_url 2018-03-31-visualgdb-54-preview-1-ESP-IDF %}">last post</a>, I took the latest Preview 1 version of <a href="http://visualgdb.com/download/">VisualGDB</a> for a test drive. This time around, I am looking at the next increment: Preview 2. Spoiler from the the blog title: it is pretty cool.<br /><br />TLDR; This is for JTAG debug ESP32 VisualGDB 5.4 Preview 2. This will not work with Preview 1. Preview 3 is now available.<br /><br />Key is to BOTH: (1) add directories as "Additional Include Directories" and (2) right-click on solution "Add existing files" for these directories:<br /><br />C:\Users\gojimmypi\Documents\Arduino\libraries\RadioHead<br />C:\Users\gojimmypi\Documents\Arduino\hardware\espressif\esp32<br />C:\Users\gojimmypi\Documents\Arduino\hardware\espressif\esp32\cores\esp32<br />C:\Users\gojimmypi\Documents\Arduino\hardware\espressif\esp32\libraries\SPI<br />C:\Users\gojimmypi\Documents\Arduino\hardware\espressif\esp32\variants\esp32<br /><div><br /></div>This Visual Studio / VisualGDB Arduino project can be downloaded here:<br /><br /><a href="https://github.com/gojimmypi/MyArduinoConversion">https://github.com/gojimmypi/MyArduinoConversion</a><br /><br />(Update 4/28: some final editing still in progress)<br /><br />First, the Arduino "sketch" is an odd critter, so close to being C/C++ but just enough different that some people have even called Arduino a language of its own. In the Ardunio IDE, File-New creates something like this (note no "main"):<br /><br /><pre><code>void setup() {<br />  // put your setup code here, to run once:<br /><br />}<br /><br />void loop() {<br />  // put your main code here, to run repeatedly:<br /><br />}</code></pre><br />The big drawback in the Arduino IDE is there's no debug. (besides - it is really just a text editor, not really an Integrated Development Environment, in my opinion).<br /><br />Debugging a sketch in Visual Studio takes a few steps. The first part here is based on the <a href="https://visualgdb.com/tutorials/esp32/esp-idf/multiple/">Switching Advanced ESP-IDF Projects Between Different IDF Versions</a>&nbsp;and&nbsp;<a href="https://visualgdb.com/tutorials/esp32/esp-idf/">Creating Advanced ESP32 Projects with ESP-IDF</a>&nbsp;tutorials. I should also add that Arduino debugging is not yet officially by VisualGDB.<br /><br />Note that I am using the <a href="http://sysprogs.com/files/visualgdb/VisualGDB-5.4-preview2.msi">PREVIEW 2 version of VisualGDB 5.4</a>&nbsp;with Visual Studio 2017..<br /><br />First, we'll need to create a project in Visual Studio with VisualGDB. This example is called myArduinoConversion: <br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-sFq2SJuaA14/Ws4x0Bgz4fI/AAAAAAAABQY/eRFUfKZTDVAA-ZMvQYU9iiyepEv3a67XgCLcBGAs/s1600/ArduinoConversion.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="497" data-original-width="909" height="218" src="https://1.bp.blogspot.com/-sFq2SJuaA14/Ws4x0Bgz4fI/AAAAAAAABQY/eRFUfKZTDVAA-ZMvQYU9iiyepEv3a67XgCLcBGAs/s400/ArduinoConversion.PNG" width="400" /></a></div><br />Leave default at "Create a new project based on a sample project". (hopefully the sysprogs folks will fix the black-on-dark-gray color scheme for those of of that choose the dark theme in Visual Studio):<br /><br /><div class="separator" style="clear: both; text-align: left;"></div><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-ZSwiuoXuJY4/Ws4zFcDFkJI/AAAAAAAABQw/Fv9eW6ScILYTk_ktvILzLLL_WEtxu0DuQCEwYBhgL/s1600/ArduinoConversion%2B-%2BNew%2BESP-IDF.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="597" data-original-width="809" height="295" src="https://1.bp.blogspot.com/-ZSwiuoXuJY4/Ws4zFcDFkJI/AAAAAAAABQw/Fv9eW6ScILYTk_ktvILzLLL_WEtxu0DuQCEwYBhgL/s400/ArduinoConversion%2B-%2BNew%2BESP-IDF.PNG" width="400" /></a></div><br />If you don't have the ESP-IDF installed, there will be a prompt:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://4.bp.blogspot.com/-J3DuCJn62uE/WtPvcP2RXaI/AAAAAAAABT0/UFpTSYx6-3oYIpEZ5bQ_EOOoTFX3jfMigCLcBGAs/s1600/VisualGDB%2BESP-IDF%2BDownload.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="698" data-original-width="861" height="324" src="https://4.bp.blogspot.com/-J3DuCJn62uE/WtPvcP2RXaI/AAAAAAAABT0/UFpTSYx6-3oYIpEZ5bQ_EOOoTFX3jfMigCLcBGAs/s400/VisualGDB%2BESP-IDF%2BDownload.PNG" width="400" /></a></div><br />In my case, there was a version error. (despite the version warning, my C:\SysGCC\esp32\esp-idf\master-VisualGDB didn't even exist!<br /><br />Click Clone an <a href="https://github.com/espressif/esp-idf">ESP-IDF from GitHub</a> link to download:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://4.bp.blogspot.com/-l9bUcqkI9m8/WtPvqUr1N_I/AAAAAAAABT4/KVkBtrNmxrskGNxw5ffkrR8U4lyw88JHACLcBGAs/s1600/Latest%2BEDP-IDF.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="208" data-original-width="529" height="156" src="https://4.bp.blogspot.com/-l9bUcqkI9m8/WtPvqUr1N_I/AAAAAAAABT4/KVkBtrNmxrskGNxw5ffkrR8U4lyw88JHACLcBGAs/s400/Latest%2BEDP-IDF.PNG" width="400" /></a></div><br />VisualGDB may give an error:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-9w7-ea_IH4w/WtPwEjY3ntI/AAAAAAAABT8/eA2hbevW1rcjq51iCe9zVMcE7b2JARjrgCLcBGAs/s1600/ESP-IDF%2Berror.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="252" data-original-width="667" height="150" src="https://3.bp.blogspot.com/-9w7-ea_IH4w/WtPwEjY3ntI/AAAAAAAABT8/eA2hbevW1rcjq51iCe9zVMcE7b2JARjrgCLcBGAs/s400/ESP-IDF%2Berror.PNG" width="400" /></a></div><br />So I manually downloaded the toolchain. Unfortunately the error message does now show the actual command being attempted:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-FP1-MVS8Id0/WtPxvqPiOvI/AAAAAAAABUM/FUdHmzaIlMIzXFA75Qs7N2dAgIqS874_QCLcBGAs/s1600/clone%2BESP-IDF%2Berror.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="177" data-original-width="477" height="118" src="https://3.bp.blogspot.com/-FP1-MVS8Id0/WtPxvqPiOvI/AAAAAAAABUM/FUdHmzaIlMIzXFA75Qs7N2dAgIqS874_QCLcBGAs/s320/clone%2BESP-IDF%2Berror.PNG" width="320" /></a></div><br /><br /><pre><code>mkdir C:\SysGCC\esp32\esp-idf\master<br />cd C:\SysGCC\esp32\esp-idf\master<br />git clone --recursive https://github.com/espressif/esp-idf.git<br /></code></pre>If you had to download your own manually, VisualGDB will not find it, even if in the specified directory. Choose the option on the right "Locate and existing ESP-IDF checkout. I purposely keep the VisualGDB stuff in this directory, as I have another ESP-IDF in my: <br /><pre><code>Documents\Arduino\hardware\espressif\esp32</code></pre>... that is used for other Arduino / <a href="http://www.visualmicro.com/">VisualMicro</a> projects. Visual GDB will me looking for the README.md file in the root of the clone project. with the above command, I would need to use the ESP-IDF checkout here:<br /><br /><pre><code>C:\SysGCC\esp32\esp-idf\master\esp-idf</code></pre><br /><br />Next, ensure the proper ESP32 toolchain is selected:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-zBaFVwiz7-o/Ws4zFjWakjI/AAAAAAAABQ8/zusaF6V6LcAd14sXZh1dBmiPSvNBDllFQCEwYBhgL/s1600/ArduinoConversion%2BToolchain.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="597" data-original-width="790" height="301" src="https://1.bp.blogspot.com/-zBaFVwiz7-o/Ws4zFjWakjI/AAAAAAAABQ8/zusaF6V6LcAd14sXZh1dBmiPSvNBDllFQCEwYBhgL/s400/ArduinoConversion%2BToolchain.PNG" width="400" /></a></div><br /><br />Next, choose a sample project. Here we use the get-started / blink template:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-VgIfjUPq35A/Ws4zFIwHbqI/AAAAAAAABRA/dZjJdDZR30gDzWoz6eMU-vRnPExb1YrPQCEwYBhgL/s1600/Arduino%2BGDB%2B-%2Bsample.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="597" data-original-width="792" height="301" src="https://1.bp.blogspot.com/-VgIfjUPq35A/Ws4zFIwHbqI/AAAAAAAABRA/dZjJdDZR30gDzWoz6eMU-vRnPExb1YrPQCEwYBhgL/s400/Arduino%2BGDB%2B-%2Bsample.PNG" width="400" /></a></div><br />Next is the JTAG driver. In my case, I am using the ESP32-WROVER-KIT V3, and I chose the interface/ftdi/esp32-devkitj_v1,cfg file:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-4UKQ3UKKZ00/Ws4zFRofBII/AAAAAAAABQ4/zKyfF4FA2gI8XWnpynUaDQZaql7Q-IAawCEwYBhgL/s1600/ArduinoConversion%2B-%2BJTAG.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="598" data-original-width="792" height="241" src="https://3.bp.blogspot.com/-4UKQ3UKKZ00/Ws4zFRofBII/AAAAAAAABQ4/zKyfF4FA2gI8XWnpynUaDQZaql7Q-IAawCEwYBhgL/s320/ArduinoConversion%2B-%2BJTAG.PNG" width="320" /></a></div><br />Here we can optionally press the "test" button, for a result like this if everything is working properly:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-LtwxU2LlkM4/Ws41GVuruNI/AAAAAAAABRU/xbefgCjZp6ccOsUwwZfFT5QwgbOgC-48QCLcBGAs/s1600/ArduinoConversion%2B-%2BJTAG%2Btest.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="563" data-original-width="843" height="213" src="https://1.bp.blogspot.com/-LtwxU2LlkM4/Ws41GVuruNI/AAAAAAAABRU/xbefgCjZp6ccOsUwwZfFT5QwgbOgC-48QCLcBGAs/s320/ArduinoConversion%2B-%2BJTAG%2Btest.PNG" width="320" /></a></div><br /><br />Although there's a "next" button there, it does not do anything; click "finish".<br /><br />WAIT. (yes, it takes a surprisingly long time) It appears nothing is happening. I think most of the time is spent setting up the project ESP-IDF container.&nbsp; Eventually a new "blink.c" file shows up:<br /><br /><br /><pre><code><br />/* Blink Example<br /><br />   This example code is in the Public Domain (or CC0 licensed, at your option.)<br /><br />   Unless required by applicable law or agreed to in writing, this<br />   software is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR<br />   CONDITIONS OF ANY KIND, either express or implied.<br />*/<br />#include &lt;stdio.h&amp;gt<br />#include "freertos/FreeRTOS.h"<br />#include "freertos/task.h"<br />#include "driver/gpio.h"<br />#include "sdkconfig.h"<br /><br />/* Can run 'make menuconfig' to choose the GPIO to blink,<br />   or you can edit the following line and set a number here.<br />*/<br />#define BLINK_GPIO CONFIG_BLINK_GPIO<br /><br />void blink_task(void *pvParameter)<br />{<br />    /* Configure the IOMUX register for pad BLINK_GPIO (some pads are<br />       muxed to GPIO on reset already, but some default to other<br />       functions and need to be switched to GPIO. Consult the<br />       Technical Reference for a list of pads and their default<br />       functions.)<br />    */<br />    gpio_pad_select_gpio(BLINK_GPIO);<br />    /* Set the GPIO as a push/pull output */<br />    gpio_set_direction(BLINK_GPIO, GPIO_MODE_OUTPUT);<br />    while(1) {<br />        /* Blink off (output low) */<br />        gpio_set_level(BLINK_GPIO, 0);<br />        vTaskDelay(1000 / portTICK_PERIOD_MS);<br />        /* Blink on (output high) */<br />        gpio_set_level(BLINK_GPIO, 1);<br />        vTaskDelay(1000 / portTICK_PERIOD_MS);<br />    }<br />}<br /><br />void app_main()<br />{<br />    xTaskCreate(&amp;blink_task, "blink_task", configMINIMAL_STACK_SIZE, NULL, 5, NULL);<br />}<br /></code></pre><br /><br />The first thing we'll need to do is take that <b>sketch_mmmdd.ino</b> file and rename it to something like main.cpp and make a few other changes.&nbsp; (hopefully in a future release, sysprogs will give the option of using C or C++ sample templates).<br /><br />In the case of this blink app,&nbsp;BLINK_GPIO is simply defined as "2" with no type. The <code>gpio_set_level</code> expects a <code>gpio_num_t</code> like this:<br /><pre><code>  gpio_set_level(static_cast&lt;gpio_num_t&gt;(BLINK_GPIO), 0);</code></pre><br />The blink.c will also need to be renamed blink.cpp (apparently to ensure the compiler knows we are doing C++ and not just C). Preview 2 does not support right-click to rename, but you can click on the file in Solution Explorer and press F2 to enable the rename.<br /><br />Only other minor tweak is needed; add <code>extern "C"</code> before the <code>void main()</code> like this: <br /><pre><code>extern "C" void app_main()</code></pre><br />The revised code now looks like this: <br /><pre><code><br />/* Blink Example<br /><br />   This example code is in the Public Domain (or CC0 licensed, at your option.)<br /><br />   Unless required by applicable law or agreed to in writing, this<br />   software is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR<br />   CONDITIONS OF ANY KIND, either express or implied.<br />*/<br />#include &lt;stdio.h&gt;<br />#include "freertos/FreeRTOS.h"<br />#include "freertos/task.h"<br />#include "driver/gpio.h"<br />#include "sdkconfig.h"<br /><br />/* Can run 'make menuconfig' to choose the GPIO to blink,<br />   or you can edit the following line and set a number here.<br />*/<br />#define BLINK_GPIO 2<br /><br />void blink_task(void *pvParameter)<br />{<br />    /* Configure the IOMUX register for pad BLINK_GPIO (some pads are<br />       muxed to GPIO on reset already, but some default to other<br />       functions and need to be switched to GPIO. Consult the<br />       Technical Reference for a list of pads and their default<br />       functions.)<br />    */<br />    gpio_pad_select_gpio(BLINK_GPIO);<br />    /* Set the GPIO as a push/pull output */<br /> gpio_set_direction(static_cast&lt;gpio_num_t&gt;(BLINK_GPIO), GPIO_MODE_OUTPUT);<br />    while(1) {<br />        /* Blink off (output low) */<br />     gpio_set_level(static_cast&lt;gpio_num_t&gt;(BLINK_GPIO), 0);<br />        vTaskDelay(1000 / portTICK_PERIOD_MS);<br />        /* Blink on (output high) */<br />     gpio_set_level(static_cast&lt;gpio_num_t&gt;(BLINK_GPIO), 1);<br />        vTaskDelay(1000 / portTICK_PERIOD_MS);<br />    }<br />}<br /><br />extern "C" void app_main()<br />{<br />    xTaskCreate(&amp;blink_task, "blink_task", configMINIMAL_STACK_SIZE, NULL, 5, NULL);<br />}<br /><br /></code></pre><br />So that all is your basic VisualGDB project. Not a whole lot new. Yet.<br /><br />I've been <a href="{{ site.baseurl }}{% post_url 2018-03-04-m5stack-lora-range-improvement %}">tinkering with LoRa</a> stuff, and being able to single-step debug the code will be helpful. I'm using the <a href="https://github.com/gojimmypi/RadioHead">RadioHead library</a> and my local copy is git-cloned into&nbsp;\Documents\libraries\RadioHead. The interesting thing here is that the library is what I call "Arduino-style". I've never been able to get VisualGDB to play well with them, so I do a lot of development with VisualMicro instead. It is less expensive and fully supports the Arduino libraries. Alas I have a tons of "if debugging serial print" statements, as the JTAGsupport is weak. (there is however a <a href="http://www.visualmicro.com/page/User-Guide.aspx?doc=Arduino-gdb-Tutorial.html">VisualMicro GDB tutorial</a> I've been meaning to check out). The reality is the sysprogs VisualGDB is simply a more extensive and robust implementation with JTAG support (with a price to show for it). The problem with the sysprogs folks however, is they never had much of an interest in Arduino.&nbsp; (Yes, I want my cake and JTAG it too!)<br /><br />So a single include statement turns out project into something considerably more interesting.<br /><br />#include "RH_RF95.h"<br /><br />Actually we'll do a few more things to instantiate the RadioHead drivers:<br /><br /><br /><pre><code>#include "RH_RF95.h"<br /><br />#define RFM95_CS 5   // LORA_CS_PIN<br />#define RFM95_RST 36 // LORA_RST_PIN is 36, TODO but it is read-only! so we'll need to short to another pin<br />#define RFM95_INT 26 // M5 LORA_IRQ_PIN 36 (jumper to 16)<br />RH_RF95 rf95(RFM95_CS, RFM95_INT);<br /></code></pre><br />Ok, so the code is actually from my M5Stack project, and I don't yet have LoRa hooked up to my lastest ESP32-WROVER, but that's beside the point...<br /><br />After adding the code, the IDE will complain:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-WG27yaa7Ieo/WtFCUg0pIpI/AAAAAAAABR8/bGdoKGbTi0I8OiY8F6Ajkkx7KdJUp_ppwCLcBGAs/s1600/No%2BRF95.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="82" data-original-width="289" src="https://3.bp.blogspot.com/-WG27yaa7Ieo/WtFCUg0pIpI/AAAAAAAABR8/bGdoKGbTi0I8OiY8F6Ajkkx7KdJUp_ppwCLcBGAs/s1600/No%2BRF95.PNG" /></a></div><br />So simply go into Project-Properties and add the path the the "Additional Include Directories". In my case that's:<br /><br />C:\Users\gojimmypi\Documents\Arduino\libraries\RadioHead<br /><br />NOTE: If your cursor is in the source code panel when you click Project-Properties, you'll get this modal dialog box. It is NOT the one to use to enter paths for include files (it didn't work for me):<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-5oD9LHg7oqk/WuEuOuVtkYI/AAAAAAAABU4/-s7AZYvD4iMZLlQPIBW10MFPQSYwU9GLwCLcBGAs/s1600/Not%2BThese%2BProperties.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="564" data-original-width="826" height="272" src="https://1.bp.blogspot.com/-5oD9LHg7oqk/WuEuOuVtkYI/AAAAAAAABU4/-s7AZYvD4iMZLlQPIBW10MFPQSYwU9GLwCLcBGAs/s400/Not%2BThese%2BProperties.PNG" width="400" /></a></div><br />Be sure to click on the project name in the solution explorer, and THEN click Project - Properties:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-yYMv4hzX-mE/WuEu67EAGDI/AAAAAAAABVA/plYB14EsjHsL3wQXDYQV9Bx-jZnQe5YcACLcBGAs/s1600/Project%2BProperties%2BSelect.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="357" data-original-width="443" height="321" src="https://2.bp.blogspot.com/-yYMv4hzX-mE/WuEu67EAGDI/AAAAAAAABVA/plYB14EsjHsL3wQXDYQV9Bx-jZnQe5YcACLcBGAs/s400/Project%2BProperties%2BSelect.PNG" width="400" /></a></div><br />...for this dialog box to enter the Additional Include File Directory paths:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-piRWXM9BVNo/WuEvAQOaeTI/AAAAAAAABVE/INihD4ARNA0rkfzRRbz_lm7ss0lep3K5gCLcBGAs/s1600/Project%2BProperties.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="549" data-original-width="829" height="263" src="https://1.bp.blogspot.com/-piRWXM9BVNo/WuEvAQOaeTI/AAAAAAAABVE/INihD4ARNA0rkfzRRbz_lm7ss0lep3K5gCLcBGAs/s400/Project%2BProperties.PNG" width="400" /></a></div><br />(note I like to make a habit of always pressing "Apply" before pressing ok, anytime that option is available)<br /><br />That will take care of finding the code, but trying to compile will give an error about platform not defined:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-V3f7HuhINko/WtFDYvv5AwI/AAAAAAAABSI/1MO3xWPjpXsbALC4WO21MszeVzVl4E0UwCLcBGAs/s1600/Platform%2BNot%2BDefined.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="112" data-original-width="437" height="82" src="https://2.bp.blogspot.com/-V3f7HuhINko/WtFDYvv5AwI/AAAAAAAABSI/1MO3xWPjpXsbALC4WO21MszeVzVl4E0UwCLcBGAs/s320/Platform%2BNot%2BDefined.PNG" width="320" /></a></div><br />The first compile will take some time. There's a shockingly large amount of code that gets compiled for such a tiny target. If when building/cleaning/rebuilding, nothing happens, simply exit Visual Studio and relaunch (see below).<br /><br />This is another one of those Arduino-style nuances. You'll notice this code in RadioHead.h header and shown here:<br /><br /><pre><code>#ifndef RH_PLATFORM<br /> #if (MPIDE&gt;=150 &amp;&amp; defined(ARDUINO))<br />  // Using ChipKIT Core on Arduino IDE<br />  #define RH_PLATFORM RH_PLATFORM_CHIPKIT_CORE<br /> #elif defined(MPIDE)<br />  // Uno32 under old MPIDE, which has been discontinued:<br />  #define RH_PLATFORM RH_PLATFORM_UNO32<br />#elif defined(NRF51)<br />  #define RH_PLATFORM RH_PLATFORM_NRF51<br />#elif defined(NRF52)<br />  #define RH_PLATFORM RH_PLATFORM_NRF52<br /> #elif defined(ESP8266)<br />  #define RH_PLATFORM RH_PLATFORM_ESP8266<br /> #elif defined(ESP32)<br />  #define RH_PLATFORM RH_PLATFORM_ESP32<br /> #elif defined(ARDUINO)<br />  #define RH_PLATFORM RH_PLATFORM_ARDUINO<br /> #elif defined(__MSP430G2452__) || defined(__MSP430G2553__)<br />  #define RH_PLATFORM RH_PLATFORM_MSP430<br /> #elif defined(MCU_STM32F103RE)<br />  #define RH_PLATFORM RH_PLATFORM_STM32<br /> #elif defined(STM32F2XX)<br />  #define RH_PLATFORM RH_PLATFORM_STM32F2<br /> #elif defined(USE_STDPERIPH_DRIVER)<br />  #define RH_PLATFORM RH_PLATFORM_STM32STD<br /> #elif defined(RASPBERRY_PI)<br />  #define RH_PLATFORM RH_PLATFORM_RASPI<br />#elif defined(__unix__) // Linux<br />  #define RH_PLATFORM RH_PLATFORM_UNIX<br />#elif defined(__APPLE__) // OSX<br />  #define RH_PLATFORM RH_PLATFORM_UNIX<br /> #else<br />  #error Platform not defined!  <br /> #endif<br />#endif<br /><br />#if defined(__AVR_ATtiny84__) || defined(__AVR_ATtiny85__) || defined(__AVR_ATtiny24__) || defined(__AVR_ATtiny44__) || defined(__AVR_ATtiny45__) || defined(__AVR_ATtinyX4__) || defined(__AVR_ATtinyX5__) || defined(__AVR_ATtiny2313__) || defined(__AVR_ATtiny4313__) || defined(__AVR_ATtinyX313__)<br /> #define RH_PLATFORM_ATTINY<br />#endif</code></pre><br />To fix, simply add "ESP32" as a Preprocessor definition: <br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://4.bp.blogspot.com/-uRAApZWRRxg/WtFEM_-TApI/AAAAAAAABSQ/-EqkqP3SPzs2yo-KRvv7SoYXnhOImnXYQCLcBGAs/s1600/ESP32%2BPreprocessor.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="367" data-original-width="758" height="192" src="https://4.bp.blogspot.com/-uRAApZWRRxg/WtFEM_-TApI/AAAAAAAABSQ/-EqkqP3SPzs2yo-KRvv7SoYXnhOImnXYQCLcBGAs/s400/ESP32%2BPreprocessor.PNG" width="400" /></a></div><br />Rebuild again. There's a subtle change in the error message:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-ytTHC4oi6zY/WtFE1T4-wzI/AAAAAAAABSk/lBchp4MyrEwjSu35gXIkW_ulEpudzR4FACLcBGAs/s1600/arduino-h-missing.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="134" data-original-width="490" height="108" src="https://3.bp.blogspot.com/-ytTHC4oi6zY/WtFE1T4-wzI/AAAAAAAABSk/lBchp4MyrEwjSu35gXIkW_ulEpudzR4FACLcBGAs/s400/arduino-h-missing.PNG" width="400" /></a></div><br />So this starts looking a bit more intimidating: Arduino.h missing for our ESP32 project. I took the brute-force approach and searched from the root of my C:\ drive:<br /><br /><br /><pre><code><br />C:<br />cd\<br />dir Arduino.h /s<br /></code></pre><br />I had a 32 matches in various locations. Some are obviously not of interest if found in an .\Arduino\ directory. In my case, I have the <a href="https://github.com/espressif/arduino-esp32">Espressif Arduino Core</a> git-cloned in my .\Documents\Hardware\Espressif directory. It can be installed like this: <br /><br /><br /><pre><code>cd %USERPROFILE%\documents<br />mkdir hardware<br />git clone --recursive https://github.com/espressif/arduino-esp32.git<br />cd arduino-esp32<br />dir Arduino.h /s<br />dir SPI.h /s<br />dir pins_arduino.h /s<br /></code></pre><br /><br /><br /><br />Put that directory in the include file list. Compile again and find another missing header file. Repeat. Note the pins_arduino.h is found in multiple directories. I chose the generic ESP32 one. After doing this a few times, VisualGDB often will complain the the settings are corrupt:      <br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-N96ZEIpXJWY/WtFJ-zPaVFI/AAAAAAAABTA/Pkjfsw5bB3sfJyic_lR0q84lhrI4b0zxACLcBGAs/s1600/corrupt%2Bsettings.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="124" data-original-width="644" height="76" src="https://2.bp.blogspot.com/-N96ZEIpXJWY/WtFJ-zPaVFI/AAAAAAAABTA/Pkjfsw5bB3sfJyic_lR0q84lhrI4b0zxACLcBGAs/s400/corrupt%2Bsettings.PNG" width="400" /></a></div><br />I simply exited Visual Studio and restarted. Upon restart, it complained out "line endings not being consistent". VisualGDB probably did this to itself; simple answer yes to fix:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-jDTp9xkl_7E/WtFKgj00z0I/AAAAAAAABTI/8A4goLqHY6kS5wyZXAvOqchWI1noYTZkQCLcBGAs/s1600/inconsistent%2Bendings.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="250" data-original-width="448" height="222" src="https://3.bp.blogspot.com/-jDTp9xkl_7E/WtFKgj00z0I/AAAAAAAABTI/8A4goLqHY6kS5wyZXAvOqchWI1noYTZkQCLcBGAs/s400/inconsistent%2Bendings.PNG" width="400" /></a></div><br />Upon doing a rebuild, I found more files missing. Repeat the procedure for finding files.<br /><br />Mine were found in:<br /><br />C:\Users\gojimmypi\Documents\Arduino\libraries\RadioHead<br />C:\Users\gojimmypi\Documents\Arduino\hardware\espressif\esp32<br />C:\Users\gojimmypi\Documents\Arduino\hardware\espressif\esp32\cores\esp32<br />C:\Users\gojimmypi\Documents\Arduino\hardware\espressif\esp32\libraries\SPI\src<br />C:\Users\gojimmypi\Documents\Arduino\hardware\espressif\esp32\variants\esp32<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-xWfIKuiSYRE/WuUcTvPZofI/AAAAAAAABXk/dzo-wEGFvdQ_HgqcqDRLumA_WnigUipagCLcBGAs/s1600/Additional%2BInclude%2BDirectories.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="547" data-original-width="829" height="263" src="https://1.bp.blogspot.com/-xWfIKuiSYRE/WuUcTvPZofI/AAAAAAAABXk/dzo-wEGFvdQ_HgqcqDRLumA_WnigUipagCLcBGAs/s400/Additional%2BInclude%2BDirectories.PNG" width="400" /></a></div><br />May also need:<br />C:\Users\gojimmypi\Documents\Arduino\hardware\espressif\esp32\variants\doitESP32devkitV1<br /><br /><div class="separator" style="clear: both; text-align: left;">Note that the include file locations is not the only place for this fix; The intellisense will be happy, however the compiler does not seem to "find" there files. There is where things get a little wonky. Those same include files paths need to be added to the project. Right-click on the project, add, existing item (for each of the directories listed above).</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="https://2.bp.blogspot.com/-XcUwTUzwT7Q/WuT4rHAT-CI/AAAAAAAABVo/-YVvXijeu4oH7BIy18O_QYaU5EY-VAA6ACLcBGAs/s1600/add%2Bfiles%2Bto%2BVisualGDB.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="509" data-original-width="676" height="300" src="https://2.bp.blogspot.com/-XcUwTUzwT7Q/WuT4rHAT-CI/AAAAAAAABVo/-YVvXijeu4oH7BIy18O_QYaU5EY-VAA6ACLcBGAs/s400/add%2Bfiles%2Bto%2BVisualGDB.PNG" width="400" /></a></div><br />Paste one of those include file paths into the File Name box. I choose to select header files (some directories have only headers!). Pick one of them. VisualGDB will recognize that there are others and prompt you to add them all. Click ok.<br /><br />If multiple files are found, there will be a prompt asking if they all should be added (yes, they should):<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-0EAlTAaRuOc/WuT7GKUJB1I/AAAAAAAABWA/9yAzpoAT4uoTWBiCv3bWP-nq6IF8JqAcgCLcBGAs/s1600/Adding%2Bsource%2Bfiles.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="298" data-original-width="591" height="201" src="https://1.bp.blogspot.com/-0EAlTAaRuOc/WuT7GKUJB1I/AAAAAAAABWA/9yAzpoAT4uoTWBiCv3bWP-nq6IF8JqAcgCLcBGAs/s400/Adding%2Bsource%2Bfiles.PNG" width="400" /></a></div><br /><br />Rebuild the project. (sometimes it can help to clean, and then do a full rebuild).<br /><br />Tada! A fully compiled Arduino-style library with VisualGDB. For me - this was really quite cool: something I've been wanting to do for a long time.<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-qIVewFJfXfs/WuT72Wz3U9I/AAAAAAAABWI/woKHhK_YIGsRpMITLt5uC_Z4KEOQGaC7ACLcBGAs/s1600/P1%2BSuccess%2BBuild.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="348" data-original-width="768" height="181" src="https://3.bp.blogspot.com/-qIVewFJfXfs/WuT72Wz3U9I/AAAAAAAABWI/woKHhK_YIGsRpMITLt5uC_Z4KEOQGaC7ACLcBGAs/s400/P1%2BSuccess%2BBuild.PNG" width="400" /></a></div><br /><br />There are still a few weird things. The include files are presented in the Solution Explorer in a pretty bizarre fashion. As these same include directories are found in the Project Properties, I really think it would be best of the directory scanning and file additions happened transparently to the developer.<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://4.bp.blogspot.com/-_25LH9Zc7hM/WuT_K8Xi_ZI/AAAAAAAABWg/GM9_qFMcX_Y2ajqEqNDu_bh5ZHaIClI_wCLcBGAs/s1600/Step%2Binto.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="596" data-original-width="1363" height="139" src="https://4.bp.blogspot.com/-_25LH9Zc7hM/WuT_K8Xi_ZI/AAAAAAAABWg/GM9_qFMcX_Y2ajqEqNDu_bh5ZHaIClI_wCLcBGAs/s320/Step%2Binto.PNG" width="320" /></a></div><br /><br />Also, It seems that breakpoint cannot be placed directly on those included files. However you can step-into them. Unfortunately the only option is step into. Step-over does not seem to work. Nor does step out. Alas this is only Preview 2, and still in development.<br /><br />The Solution Explorer also looks a bit odd:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://3.bp.blogspot.com/-FIL9i1wj0po/WuUGYd47QcI/AAAAAAAABXI/lYT_jHpM74kttQoDYGQCmQfZdKBFQlnGwCLcBGAs/s1600/Soluition%2BExplorer%2BOddity.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="590" data-original-width="458" height="400" src="https://3.bp.blogspot.com/-FIL9i1wj0po/WuUGYd47QcI/AAAAAAAABXI/lYT_jHpM74kttQoDYGQCmQfZdKBFQlnGwCLcBGAs/s400/Soluition%2BExplorer%2BOddity.PNG" width="310" /></a></div><br /><br />There's also some wonkiness with OpenOCD when code is paused too long. I think there's some sort of panic watchdog that is not fed while single-step debug is paused:<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-iTK5c8G3r-A/WuUAIb7t8gI/AAAAAAAABWs/5VePG9jZOXYNDjZeISg_rmzzS0y_yp5YACLcBGAs/s1600/Pause%2BTimeout.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="432" data-original-width="615" height="280" src="https://1.bp.blogspot.com/-iTK5c8G3r-A/WuUAIb7t8gI/AAAAAAAABWs/5VePG9jZOXYNDjZeISg_rmzzS0y_yp5YACLcBGAs/s400/Pause%2BTimeout.PNG" width="400" /></a></div><br /><br />And no sooner do I polish this Preview 2 blog... the <a href="http://sysprogs.com/files/visualgdb/VisualGDB-5.4-preview3.msi">sysprogs folks have already released Preview 3</a>! (And yes, it DOES appear to work in Preview 3 as well!)<br /><br />* July 2018 edit:<br /><br />Over the course of time, my Windows 10 drivers were changed, resulting in the dreaded message:<br /><code></code><br /><pre><code>Error: libusb_open() failed with LIBUSB_ERROR_ACCESS<br />Error: no device found<br />Error: unable to open ftdi device with vid 0403, pid 6010, description '*', serial '*' at bus location '*'<br /></code></pre><code></code><br /><br /><div>Zadig to the rescue once again! Change both drivers on <code>Interface 0</code> and <code>Interface 1</code> to <code>libusbk</code>.<br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="https://1.bp.blogspot.com/-c4V-yJYb4sI/W0ODuZiYtbI/AAAAAAAABiA/PQXoVTjeXSYNK2qUIGoZmi0giiCbe3JhACLcBGAs/s1600/DEVC-libusbk.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="261" data-original-width="581" height="178" src="https://1.bp.blogspot.com/-c4V-yJYb4sI/W0ODuZiYtbI/AAAAAAAABiA/PQXoVTjeXSYNK2qUIGoZmi0giiCbe3JhACLcBGAs/s400/DEVC-libusbk.PNG" width="400" /></a></div><br />I am using the config file found in:<br /><br /><code>C:\sysgcc\esp32\esp32-bsp\OpenOCD\share\openocd\scripts\interface\ftdi\esp32_devkitj_v1.cfg</code><br /><br />That specifically looks like this:<br /><br /><code></code><br /><pre><code>#<br /># Driver for the FT2232H JTAG chip on the Espressif DevkitJ board<br />#<br /> <br /><br />interface ftdi<br />ftdi_vid_pid 0x0403 0x6010<br /><br /># interface 1 is the uart<br />ftdi_channel 0<br /># just TCK TDI TDO TMS, no reset<br />ftdi_layout_init 0x0008 0x000b<br />reset_config none<br /></code></pre><code></code><br /><br /><br /><ul><li><a href="https://sysprogs.com/w/forums/topic/import-arduino-projects-andor-libraries/">Import ESP8266 Arduino Projects and/or Libraries</a></li><li><a href="https://dl.espressif.com/doc/esp-idf/latest/get-started/get-started-wrover-kit.html">ESP-WROVER-KIT V3 Getting Started Guide</a></li><li><a href="https://dl.espressif.com/dl/schematics/ESP-WROVER-KIT_SCH-3.pdf">ESP-WROVER-KIT V3 Schematic</a></li><li><a href="https://dl.espressif.com/doc/esp-idf/latest/get-started/add-idf_path-to-profile.html#add-idf-path-to-profile-windows">Add IDF_PATH to User Profile</a></li><li><a href="https://www.espressif.com/sites/default/files/documentation/esp32-wrover_datasheet_en.pdf">ESP32 WROVER Datasheet</a></li><li><a href="https://sysprogs.com/w/forums/topic/feedback-for-visualgdb-5-4-preview-1-with-support-for-advanced-esp-idf/">Feedback for VisualGDB 5.4 preview 1 with support for advanced-esp-idf</a></li><li><br /></li></ul></div>