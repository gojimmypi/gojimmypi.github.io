---
layout: post
title: 'Sigrok on WSL for iua: ice40 USB Analyzer'
date: '2020-08-09T17:27:00.004-07:00'
author: gojimmypi
tags:
- icebreaker
- X-Windows
- Sigrok
- WSL
- FPGA
modified_time: '2020-08-11T15:21:36.658-07:00'
thumbnail: https://1.bp.blogspot.com/-AsCx1ME8ZkY/XzBMCywuERI/AAAAAAAACms/lRNv0tmY-AwHsCIyh36hVH9jNuDtHbh1gCLcBGAsYHQ/s72-c/vmware_waiting.png
blogger_id: tag:blogger.com,1999:blog-4109066286647243251.post-3817515010519623638
blogger_orig_url: https://gojimmypi.blogspot.com/2020/08/sigrok-on-wsl-for-iua-ice40-usb-analyzer.html
---

<p>In <a href="https://gojimmypi.blogspot.com/2020/08/icebreaker-bitsy-fpga-early-adopter.html">my previous post on the iCEBreaker Bitsy FPGA - early adopter version</a>, I mentioned the interesting&nbsp;<a href=" https://github.com/smunaut/iua">iua: ice40 USB Analyzer</a>&nbsp;project that I learned about on the <a href="https://canary.discord.com/invite/4qArnb?utm_source=Discord%20Widget&amp;utm_medium=Connect">iCEBreaker discord channel</a>&nbsp;in the context of troubleshooting the odd problem I was seeing on my "Power Share" USB3.0 port.</p> <p>There's minimal documentation on Getting Started, so here I am creating my notes.</p> <p>The <code>iua</code> is meant for the iCEBreaker, not the Bitsy (although I wonder if it would still work on the Bisty? another rabbit hole for another day...)</p> <p>As with all prior posts, I'm a Visual Studio developer at the day job, and continue that with my FPGA learning on the weekends... thus I use Windows, WSL, and Visual Studio here.</p><br /><code><pre>cd /mnt/c/workspace/<br />git clone https://github.com/smunaut/iua.git<br />cd iua/hdl<br />make<br /></pre></code><br />As reminder, if you have a VM running, make sure you are not having problems with a prompt awaiting device connection:<div class="separator" style="clear: both;"><a href="https://1.bp.blogspot.com/-AsCx1ME8ZkY/XzBMCywuERI/AAAAAAAACms/lRNv0tmY-AwHsCIyh36hVH9jNuDtHbh1gCLcBGAsYHQ/s467/vmware_waiting.png" style="display: block; padding: 1em 0px;"><img border="0" data-original-height="139" data-original-width="467" src="https://1.bp.blogspot.com/-AsCx1ME8ZkY/XzBMCywuERI/AAAAAAAACms/lRNv0tmY-AwHsCIyh36hVH9jNuDtHbh1gCLcBGAsYHQ/s0/vmware_waiting.png" /></a></div><div><br /> Also, even if you've used <code>iceprog</code> before and it decides to not find the icEBreaker today, check the drivers with Zadig. Windows seems to like to replace the drivers during updates. The iCEBreaker needs the <code>libusbK</code> drivers.</div> <div class="separator" style="clear: both;"><a href="https://1.bp.blogspot.com/-4xqK5UEqw54/XzBMJjycwmI/AAAAAAAACmw/WQB_csa0zo4ekDmpU31OcT9g0H1chlx_QCLcBGAsYHQ/s598/zadig_icebreaker.png" style="display: block; padding: 1em 0px;"><img border="0" data-original-height="262" data-original-width="598" src="https://1.bp.blogspot.com/-4xqK5UEqw54/XzBMJjycwmI/AAAAAAAACmw/WQB_csa0zo4ekDmpU31OcT9g0H1chlx_QCLcBGAsYHQ/s0/zadig_icebreaker.png" /></a></div><div><br /> <div>Unlike the Bitsy that needs to have bootloader boot set by holding the button at power-on time for <code>dfu-util</code>, the iCEBreaker does NOT need that when using <code>iceprog</code></div>    <br /> As there's no native USB support in my WSL, I use the DOS exe to send the binary to the device either from DOS:<br /><br />  <code><pre>C:\workspace\ulx3s-toolchain\bin\iceprog.exe <br /></pre></code><br />or from WSL:<br /><br />   <code><pre>/mnt/c/workspace/ulx3s-toolchain/bin/iceprog.exe iua_icebreaker_top.bin<br /></pre></code>When successful, there should be output that looks something like this:<br /><br />   <code><pre>init..<br />cdone: high<br />reset..<br />cdone: low<br />flash ID: 0xEF 0x40 0x18 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00<br />file size: 104090<br />erase 64kB sector at 0x000000..<br />erase 64kB sector at 0x010000..<br />programming..<br />reading..<br />VERIFY OK<br />cdone: high<br />Bye.<br /></pre></code><br /><br />So that was the easy part. (The easy part is always the thing you already know). The next part - sigrok - is something that I've wanted to learn more about for quite some time. There's another&nbsp;<a href="https://github.com/smunaut/libsigrok">smunaut/libsigrok</a>&nbsp;project needed, which is a modified fork of&nbsp;<a href="https://github.com/sigrokproject/libsigrok">sigrokproject/libsigrok</a>&nbsp;and needs to be built like this:</div><div><br /><code><pre>git clone git://sigrok.org/libsigrok<br />cd libsigrok<br />./autogen.sh<br />./configure<br />make<br /></pre></code> <br />   <br />  People often ask why I deal with the annoyances of Windows. Well, Linux has plenty as well, imho. I had most of the dependencies already installed, but receieved this error diring <code>make</code>   <code><pre>configure: error: Package requirements (glib-2.0 &gt;= 2.32.0 libftdi1 &gt;= 1.0 libusb-1.0 &gt;= 1.0.16 gio-2.0 &gt;= 2.24.0 libzip &gt;= 0.10) were not met:<br /><br />No package 'libzip' found<br /></pre></code> <br />   <br />    And so what's the first thing to try? Well, <code>sudo apt-get install libzip</code>, right? Nope. :/   <br />   <br />        <code><pre>Reading package lists... Done<br />Building dependency tree<br />Reading state information... Done<br />E: Unable to locate package libzip</pre></code> <br />   <br />  grumble, grumble, google, grumble....  <br />   <br />  There's <a href="https://sigrok.org/wiki/Building">only one reference on the wiki</a>, and it only notes I need <code>libzip &gt;= 0.10</code>. But where to find it? Ah yes, it is just the development code library, not a tool, so we need the <code>-dev</code> suffix:  <br />   <br />     <code><pre>sudo apt-get install libzip-dev</pre></code> <br />   <br />    Ok, now to run <code>./configure</code> again...  <br />   <br />    Closer this time; I am still missing some things:  <br />  <br /><code><pre>Enabled language bindings:<br /> - C++............................. no (missing: glibmm, Doxygen)<br /> - Python.......................... no (missing: C++ bindings, PyGObject, SWIG)<br /> - Ruby............................ no (missing: C++ bindings, SWIG)<br /> - Java............................ no (missing: C++ bindings, SWIG, JavaC, JNI headers)<br /><br />===============================================================================<br />WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING<br />===============================================================================<br />===                                                                         ===<br />===         The libsigrok C++ bindings are not being built since you        ===<br />===             are missing one or more dependencies (see above)!           ===<br />===                                                                         ===<br />===      This means you won't be able to compile frontends that require     ===<br />===  the C++ bindings (such as PulseView)! You also won't be able to build  ===<br />===     other bindings and frontends using those (such as sigrok-meter)!    ===<br />===                                                                         ===<br />===============================================================================<br />WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING<br />===============================================================================<br /></pre></code> <br />   <br /> ugh. <br />   <code><pre>gojimmypi:/mnt/c/workspace/libsigrok<br />$ sudo apt-get install glibmm<br />Reading package lists... Done<br />Building dependency tree<br />Reading state information... Done<br />E: Unable to locate package glibmm<br />gojimmypi:/mnt/c/workspace/libsigrok<br />$ sudo apt-get install glibmm-dev<br />Reading package lists... Done<br />Building dependency tree<br />Reading state information... Done<br />E: Unable to locate package glibmm-dev<br />gojimmypi:/mnt/c/workspace/libsigrok<br /></pre></code> <br />   <br />  grumble, grumble, google, grumble....  <br />   <br />  This one requires a version number in the name. Of course it does. So onward to install: <a href="https://ubuntu.pkgs.org/18.04/ubuntu-main-amd64/libglibmm-2.4-dev_2.56.0-1_amd64.deb.html">glibmm</a>. I'll grab <code>doxygen</code> too, and then one more <code>./configure</code> as well:<br />  <br />  <code><pre>sudo apt-get install libglibmm-2.4-dev<br />sudo apt-get install doxygen<br />./configure<br /></pre></code>  <br />  <br />  No warnings! Hurray!! So on to a (very long running) <code>make</code>, then:    <br />  <br />   <code><pre>  <br />$ make check<br />make<br />make  all-am<br />make  check-TESTS<br />============================================================================<br />Testsuite summary for libsigrok 0.6.0<br />============================================================================<br /># TOTAL: 0<br /># PASS:  0<br /># SKIP:  0<br /># XFAIL: 0<br /># FAIL:  0<br /># XPASS: 0<br /># ERROR: 0<br />============================================================================<br /></pre></code>  <br />  <br />   <code><pre>$ sudo make install<br /> /bin/mkdir -p '/usr/local/lib'<br /> /bin/bash ./libtool --silent  --mode=install /usr/bin/install -c   libsigrok.la bindings/cxx/libsigrokcxx.la '/usr/local/lib'<br />libtool: warning: relinking 'bindings/cxx/libsigrokcxx.la'<br /> /bin/mkdir -p '/usr/local/include/libsigrokcxx'<br /> /usr/bin/install -c -m 644 bindings/cxx/include/libsigrokcxx/libsigrokcxx.hpp '/usr/local/include/libsigrokcxx'<br /> /bin/mkdir -p '/usr/local/include/libsigrok'<br /> /usr/bin/install -c -m 644 include/libsigrok/libsigrok.h include/libsigrok/proto.h '/usr/local/include/libsigrok'<br /> /bin/mkdir -p '/usr/local/share/mime/packages'<br /> /usr/bin/install -c -m 644 contrib/vnd.sigrok.session.xml '/usr/local/share/mime/packages'<br /> /bin/mkdir -p '/usr/local/share/icons/hicolor/48x48/mimetypes'<br /> /usr/bin/install -c -m 644 contrib/libsigrok.png '/usr/local/share/icons/hicolor/48x48/mimetypes'<br /> /bin/mkdir -p '/usr/local/share/icons/hicolor/scalable/mimetypes'<br /> /usr/bin/install -c -m 644 contrib/libsigrok.svg '/usr/local/share/icons/hicolor/scalable/mimetypes'<br /> /bin/mkdir -p '/usr/local/include/libsigrokcxx'<br /> /usr/bin/install -c -m 644 bindings/cxx/include/libsigrokcxx/enums.hpp '/usr/local/include/libsigrokcxx'<br /> /bin/mkdir -p '/usr/local/include/libsigrok'<br /> /usr/bin/install -c -m 644 include/libsigrok/version.h '/usr/local/include/libsigrok'<br /> /bin/mkdir -p '/usr/local/lib/pkgconfig'<br /> /usr/bin/install -c -m 644 libsigrok.pc bindings/cxx/libsigrokcxx.pc '/usr/local/lib/pkgconfig'  <br /></pre></code>  <br />  <br />Next is to install decoder:   <br />  <code><pre>git clone https://github.com/sigrokproject/libsigrokdecode.git<br />cd libsigrokdecode<br />./autogen.sh<br />./configure<br />make<br />sudo make install<br /></pre></code>  <br />  <br /> Next is to install <a href="https://sigrok.org/wiki/PulseView">Pulseview</a>! (see also <a href="https://sigrok.org/wiki/Linux#Building_5">build info</a>). Despite having the <a href="https://sigrok.org/wiki/Linux#Installing_the_requirements_5">requirements</a> installed, I also needed:   <br />  <br />   <code><pre>sudo apt-get install qttools5-dev<br /></pre></code>  <br />  <br />      <code><pre>  <br />git clone https://github.com/sigrokproject/pulseview.git<br />cd pulseview<br />cmake .<br />make<br />sudo make install<br /></pre></code>  <br />  <br />     Still following along? After all this, it is time to actually run <code>pulseview</code>! Alas on WSL we have an extra challenge: X-Windows. I'm using <code>vcxsrv</code> from the ad-spam-ridden sourceforge. (it is really a shame to see what that site has become).    <br />  <br /><code><pre>C:\Program Files\VcXsrv\vcxsrv.exe<br /></pre></code>  <br />  <br />      See <a href="https://sigrok.org/wiki/Linux#Building_2">building libsigrok</a>, but use the <code>smunaut/libsigrok</code>     <br />  <br />   <code><pre>sudo apt-get install git-core gcc make autoconf automake libtool<br />git clone https://github.com/sigrokproject/libserialport.git  <br />cd libserialport<br />./autogen.sh<br />./configure<br />make<br />sudo make install <br /></pre></code>  <br />  <br />    <code><pre>git clone https://github.com/smunaut/libsigrok.git smunaut-libsigrok<br />cd smunaut-libsigrok<br />./autogen.sh  <br />./configure<br />make<br />sudo make install<br /></pre></code>  <br />  <br />   See <a href="https://github.com/smunaut/iua/issues/2">build failure for smunaut/libsigrok #2</a>  <br />  <br />         If after doing a <code>make clean</code> for pulseview, and an error like this is enountered:  <code><pre>$ make<br />[  1%] Automatic MOC for target pulseview<br />[  1%] Built target pulseview_autogen<br />make[2]: *** No rule to make target 'l10n/de.qm', needed by 'qrc_translations.cpp'.  Stop.<br />CMakeFiles/Makefile2:67: recipe for target 'CMakeFiles/pulseview.dir/all' failed<br />make[1]: *** [CMakeFiles/pulseview.dir/all] Error 2<br />Makefile:151: recipe for target 'all' failed<br />make: *** [all] Error 2<br /></pre></code>  <br />  <br />   The problem seems to be that <code>make clean</code> improperly deletes a couple of files:         <br />  <br />  <code><pre>gojimmypi:/mnt/c/workspace/pulseview<br />$ git status<br />On branch master<br />Your branch is up to date with 'origin/master'.<br /><br />Changes not staged for commit:<br />  (use "git add/rm &lt;file&gt;..." to update what will be committed)<br />  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)<br /><br />        deleted:    l10n/de.ts<br />        deleted:    l10n/es_MX.ts<br /><br />no changes added to commit (use "git add" and/or "git commit -a")<br />gojimmypi:/mnt/c/workspace/pulseview<br /></pre></code>  <br />  <br />   So simply put them back:     <br />  <br />     <code><pre>git checkout master<br />git checkout l10n/de.ts<br />git checkout l10n/es_MX.ts  <br /></pre></code>  <br />  <br />   Despite   <code><pre>gojimmypi:/mnt/c/workspace/smunaut-libsigrok<br />$ ./configure<br />...<br />Detected libraries (optional):<br /> - libserialport >= 0.1.1.......... 0.1.1<br /></pre></code>  <br />  <br />   I still saw wthis error: <code><pre>pulseview: error while loading shared libraries: libserialport.so.0: cannot open shared object file: No such file or directory  <br /></pre></code>  <br />  <br />     <code><pre>sudo apt-get install libserialport-dev <br /></pre></code>  <br />  <br />       </div>     