---
layout: post
title: "hello"
date: '2021-08-10'
author: gojimmypi
tags:
- ESP32
- WolfSSL
- SSH
---

This is a sample page. Testing the missing 2021-08-05 file. v5

- ## Overview

There are two Visual Studio solution files: a regular, 32-bit environment, and a 64-bit one. 
Oddly, my Visual Studio 2019 did not seem to be happy with the 64 bit solution. Although the code would compile,
there were hundreds of false errors related to IDE processing (or lack thereof) dependency files.

`ctx` is "SSL Context"; See [wolfSSL Context and Session Set Up](https://www.wolfssl.com/doxygen/group__Setup.html)

`ourDhParam` is "the filename of the Diffie-Hellman cert we will use". Default: `./certs/dh2048.pem`.

see [line 1940 of wolfssl/wolfssl/test.h](https://github.com/wolfSSL/wolfssl/blob/bd6b765b17299e8fa9d1a6dc432c4da9597f0cf9/wolfssl/test.h#L1940) for blocking accept(); 
This is 5 packet init exchange that should include `hello`:
```
    *clientfd = accept(*sockfd, (struct sockaddr*)client_addr,
                      (ACCEPT_THIRD_T)client_len);
```

- ## WSL SSH Server

- ### Configure WSL SSH Server Service

See `/etc/ssh/sshd_config`:
```
Port 2211
ListenAddress 192.168.1.25
```

- ### Start the service

```
sudo service ssh start
```

- ### Generate keys

```
C:\workspace\wolfssl-demo>ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (C:\Users\gojimmypi/.ssh/id_rsa): c:\workspace\wolfssl-demo\cert\gojimmypi
...etc
```

- ### Append the public key to the WSL ~/.ssh/authorized_keys

Note the server is running in WSL, so the keys are in `~/.ssh`. Adding this `authorized_key` allows us to connecte to 
local ssh server from local host.

```
cat /mnt/c/workspace/wolfssl-demo/cert/gojimmypi.pub >> ~/.ssh/authorized_keys
```

- ### Connect to WSL SSH Server from DOS, specifying the private key file:

```
ssh -p 2211 -vvvv -i c:\workspace\wolfssl-demo\cert\gojimmypi 192.168.1.25
```

- ## Set WiFi

See: `sdkconfig.h`

```
#define CONFIG_EXAMPLE_WIFI_SSID "yourwifi"
#define CONFIG_EXAMPLE_WIFI_PASSWORD "yourpassword"
```
in
```
C:\workspace\wolfssl-demo\IDE\Espressif\ESP-IDF\examples\wolfssl_server\build\include\sdkconfig.h
```

- ## Building 
See [wolfSSH requires the wolfSSL library. The steps are:](https://github.com/wolfSSL/wolfssl/issues/4272#issuecomment-891199577)
```
sudo echo "Here we go. If prompted for password, press ctrl-c"
git clone https://github.com/wolfssl/wolfssl.git wolfssl-demo
cd wolfssl-demo
./autogen.sh
./configure --enable-openssh
make
sudo make install
sudo ldconfig

. $HOME/esp/esp-idf/export.sh
cd /mnt/c/workspace/wolfssl-demo/IDE/Espressif/ESP-IDF/examples/wolfssl_server

# For Linux:
# python /home/gojimmypi/esp/esp-idf/components/esptool_py/esptool/esptool.py --chip esp32 --port /dev/ttyUSB0 --baud 115200 --before default_reset --after hard_reset write_flash -z --flash_mode dio --flash_freq 40m --flash_size detect 0x1000 /mnt/c/workspace/wolfssl-demo/IDE/Espressif/ESP-IDF/examples/wolfssl_server/build/bootloader/bootloader.bin  0x10000  /mnt/c/workspace/wolfssl-demo/IDE/Espressif/ESP-IDF/examples/wolfssl_server/build/tls_server.bin 0x8000  /mnt/c/workspace/wolfssl-demo/IDE/Espressif/ESP-IDF/examples/wolfssl_server/build/partitions_singleapp.bin

# For WSL:
/mnt/c/python36/python.exe c:\\workspace\\esp-build\\esptool.py                --chip esp32 --port COM4        --baud 115200 --before default_reset --after hard_reset write_flash -z --flash_mode dio --flash_freq 40m --flash_size detect 0x1000 c:\\workspace\\wolfssl\\IDE\\Espressif\\ESP-IDF\\examples\\wolfssl_server\\build\\bootloader\\bootloader.bin 0x10000  c:\\workspace\\wolfssl\\IDE\\Espressif\\ESP-IDF\\examples\\wolfssl_server\\build\\tls_server.bin 0x8000  c:\\workspace\\wolfssl\\IDE\\Espressif\\ESP-IDF\\examples\\wolfssl_server\\build\\partitions_singleapp.bin

```

- # Espressif ESP32GH missing fix 2
```
cd ~/esp
. $HOME/esp/esp-idf/export.sh
cp -r /mnt/c/workspace/WolfSSL/IDE/Espressif/ESP-IDF/examples/wolfssl_server .
cd wolfssl_server

cp ~/esp/esp-idf/components/esptool_py/esptool/esptool.py /mnt/c/workspace/esp-build/esptool.py

# from WSL:
/mnt/c/python36/python.exe c:\\workspace\\esp-build\\esptool.py --chip esp32 --port COM4 --baud 115200 --before default_reset --after hard_reset write_flash -z --flash_mode dio --flash_freq 40m --flash_size detect 0x1000 c:\\workspace\\wolfssl\\IDE\\Espressif\\ESP-IDF\\examples\\wolfssl_server\\build\\bootloader\\bootloader.bin 0x10000 c:\\workspace\\wolfssl\\IDE\\Espressif\\ESP-IDF\\examples\\wolfssl_server\\build\\tls_server.bin 0x8000 c:\\workspace\\wolfssl\\IDE\\Espressif\\ESP-IDF\\examples\\wolfssl_server\\build\\partitions_singleapp.bin

make menuconfigure
idf.py build

grep -rnw './' -e 'WOLFSSL_AES_COUNTER' | grep " #define "
grep -rnw '/mnt/c/workspace/WolfSSL' -e 'WOLFSSL_AES_COUNTER'
```

WSL attempt to connect to ESP32 (not working)
```
ssh -p 11111 -vvvvv -i /mnt/c/workspace/wolfssl-demo/certs/gojimmypi  gojimmypi@192.168.1.31
```

WSL attempt to connect to local ssh server
```

```

DOS connect to local ssh server:
